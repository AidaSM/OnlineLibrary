@model BookModel
@using System.Security.Claims

@{
    ViewData["Title"] = "Book Details";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<style>
    #blur-background {
        position: fixed;
        width: 100%;
        height: 100%;
        top: 0;
        left: 0;
        z-index: -1;
    }

    .blurred-image {
        width: 100%;
        height: 100%;
        object-fit: cover;
        filter: blur(10px);
    }
</style>

<script src="https://cdnjs.cloudflare.com/ajax/libs/blurify/1.0.1/blurify.min.js"></script>

<div id="blur-background">
    <img src="@Url.Content(Model.ImagePath)" alt="@Model.Title" class="blurred-image" />
</div>

<div class="card mb-4">
    <div class="card-body">
        <h2 class="card-title text-center mb-4">Book Details</h2>

        <div class="row">
            <div class="col-md-6">
                <img src="@Url.Content(Model.ImagePath)" alt="@Model.Title" class="img-fluid rounded" style="max-height: 400px; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);" />
            </div>

            <div class="col-md-6">
                <h3>@Model.Title</h3>
                <p><strong>Author:</strong> @Model.IdauthorNavigation.Name</p>
                <p><strong>Genre:</strong> @Model.IdgenreNavigation.Name</p>

                <!-- Reserve form -->
                <form id="reserveForm">
                    <input type="hidden" name="bookId" value="@Model.Idbook" />
                    <input type="hidden" name="userId" value="@User.FindFirstValue(ClaimTypes.NameIdentifier)" />
                    <input type="hidden" name="idbook" value="@Model.Idbook" />

                    <button type="button" id="reserveButton" class="btn btn-success btn-block mt-3">Reserve This Book</button>
                </form>

                <!-- Display reviews -->
                <h4>Reviews</h4>
                <ul>
                    @foreach (var review in Model.Reviews)
                    {
                        <li>
                            
                            <span>Rating: @review.Rating</span>
                            <p>@review.Text</p>
                        </li>
                    }
                </ul>
            </div>
        </div>
    </div>
</div>

@section scripts {
    <script>
        $(document).ready(function () {
            $("#reserveButton").click(function () {
                var bookId = $("#reserveForm input[name='bookId']").val();

                $.ajax({
                    type: "POST",
                    url: "/Transaction/ReserveBook",
                    data: { idbook: bookId },
                    success: function (result) {
                        $("<div class='alert alert-success mt-3'>" + result.message + "</div>").appendTo("#reserveForm").fadeOut(3000);
                    },
                    error: function (error) {
                        $("<div class='alert alert-danger mt-3'>Error: " + error.responseJSON.message + "</div>").appendTo("#reserveForm").fadeOut(3000);
                    }
                });
            });
        });
    </script>
}
